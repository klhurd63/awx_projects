---
- hosts: ansbile.builtin.systemd_service
  become: yes
  
  tasks:
# Add New Logic Monitor collectors to snmpd.conf 
- name: Add new collectors into the /etc/snmp/snmpd.conf file
  ansible.builtin.blockinfile:
    path: /etc/snmp/snmpd.conf
    backup: yes 
    block:  
      rocommunity {{ "markel_community" }} {{ "lm_collector" }}
    insertafter:
# Add rich rule to Firewall
- name: Rich Rule to add new Collector IPs
  ansible.posix.firewalld:
    rich_rule: rule family=ipv4 source address={{ "lm_collector" }} port port=161 protocal=udp accept
    zone: public
    permanent: true
    immediate: true
    state: enabled
# Reload the firewalld service after modifications have been made
- name: Always Reload firewalld #ansible.builtin.service can also be used
  ansbile.builtin.systemd_service:
    name: firewalld
    state: reloaded
